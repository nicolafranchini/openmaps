jQuery(document).ready(function(e){"use strict";var n;e(document).on("click",".openmaps_marker_upload_btn",function(a){var o=e(this).prev(".openmaps_custom_marker-wrap").find(".openmaps_custom_marker");a.preventDefault(),(n=wp.media.frames.om_metaImageFrame=wp.media()).on("select",function(){var a=n.state().get("selection").first().toJSON();e(o).val(a.url)}),n.open()}),e(document).on("click",".openmaps_marker_remove_btn",function(n){var a=e(this).parent().find(".openmaps_custom_marker");n.preventDefault(),e(a).val("")});var a={tinymce:!0,quicktags:{buttons:"strong,em,link,ul,ol,li,del,close"}};e(".openmaps_marker_editor").each(function(){var n=e(this).find("textarea").attr("id");wp.editor.initialize(n,a)}),e(".wpol-new-marker").on("click",function(){if(e(".wrap-clone").length)var n=e(".wrap-clone").last().find(".clone-marker").clone();else n=e(".clone-marker").last().clone();var o=parseFloat(n.data("index")),t=o+1,r='<div class="wrap-clone" id="wrap-clone-'+t+'"><strong class="wpol-badge"> #'+t+"</strong></div>";n.attr("data-index",t),n.find("input").attr("value",""),n.find("option:selected").removeAttr("selected"),n.find("input:checked").prop("checked",!1),n.find("input").each(function(){this.name=this.name.replace("["+o+"]","["+t+"]")}),e(r).appendTo(".wrap-marker"),n.appendTo("#wrap-clone-"+t),e('<div class="wp-editor-container openmaps_marker_editor"><textarea id="openmaps_infobox_'+t+'" name="openmaps_marker['+t+'][infobox]" class="wp-editor-area" rows="4"></textarea></div>').appendTo("#wrap-clone-"+t),wp.editor.initialize("openmaps_infobox_"+t,a);e('<div class="wpol-remove-marker wpol-btn-link"><span class="dashicons dashicons-no"></span></div>').appendTo("#wrap-clone-"+t)}),e(document).on("click",".wpol-remove-marker",function(){e(this).parent(".wrap-clone").remove()}),e("#wpol-admin-map").length&&e("#infomarker_admin").length&&function(n,a){if("undefined"==typeof ol||null===ol)return console.log("WARNING: OpenLayers Library not loaded"),!1;var o=ol.proj.fromLonLat([-74.005974,40.712776]),t=new ol.View({center:o,zoom:2}),r=new ol.Map({target:"wpol-admin-map",view:t,layers:[new ol.layer.Tile({source:new ol.source.OSM})],interactions:ol.interaction.defaults({mouseWheelZoom:!1})}),l=new ol.Overlay({position:o,positioning:"center-center",offset:[0,-20],element:document.getElementById(a)});r.addOverlay(l),r.on("click",function(n){var a=n.coordinate,o=ol.proj.toLonLat(a);e(".openmaps-get-lat").val(o[1]),e(".openmaps-get-lon").val(o[0]),l.setPosition(a)}),e(".openmaps-get-coordinates").on("click",function(){var n=e(this),a=e(".openmaps-set-address").val();if(a.length>3){n.hide();var o=encodeURIComponent(a);e.ajax({url:"https://nominatim.openstreetmap.org/search?q="+o+"&format=json",type:"GET"}).done(function(n){var a,o,r,p;o=(a=n)[0].lat,r=a[0].lon,p=ol.proj.fromLonLat([r,o]),l.setPosition(p),t.setCenter(p),t.setZoom(6),e(".openmaps-get-lat").val(o),e(".openmaps-get-lon").val(r)}).always(function(){n.fadeIn()})}})}(0,"infomarker_admin"),e(".wpol-call-repeat").on("click",function(){e(".wpol-repeatable-group");var n=e(".wpol-repeatable-item").last().data("number"),a=parseFloat(n)+1,o='<div class="wpol-repeatable-item wpol-form-group" data-number="'+a+'"><input type="text" class="all-options" name="openmaps_settings[style]['+a+'][name]" value="map style '+a+'"> <input type="url" class="regular-text" name="openmaps_settings[style]['+a+'][url]" value="" placeholder="https://api.maptiler.com/maps/.../style.json?key=..."></div>';e(".wpol-repeatable-group").append(o)}),document.onkeypress=function(e){var n=(e=e||event||null).target?e.target:e.srcElement?e.srcElement:null;if(13==e.keyCode&&("text"==n.type||"url"==n.type||"number"==n.type))return!1}});
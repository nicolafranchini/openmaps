jQuery(document).ready(function(e){"use strict";var n;e(document).on("click",".venomaps_marker_upload_btn",function(o){var t=e(this).prev(".venomaps_custom_marker-wrap").find(".venomaps_custom_marker");o.preventDefault(),(n=wp.media.frames.om_metaImageFrame=wp.media()).on("select",function(){var o=n.state().get("selection").first().toJSON();e(t).val(o.url)}),n.open()}),e(document).on("click",".venomaps_marker_remove_btn",function(n){var o=e(this).parent().find(".venomaps_custom_marker");n.preventDefault(),e(o).val("")});var o={tinymce:!0,quicktags:{buttons:"strong,em,link,ul,ol,li,del,close"}};e(".venomaps_marker_editor").each(function(){var n=e(this).find("textarea").attr("id");wp.editor.initialize(n,o)}),e(".wpol-new-marker").on("click",function(){if(e(".wrap-clone").length)var n=e(".wrap-clone").last().find(".clone-marker").clone();else n=e(".clone-marker").last().clone();var t=parseFloat(n.data("index")),a=t+1,r='<div class="wrap-clone" id="wrap-clone-'+a+'"><strong class="wpol-badge"> #'+a+"</strong></div>";n.attr("data-index",a),n.find("input").attr("value",""),n.find("option:selected").removeAttr("selected"),n.find("input:checked").prop("checked",!1),n.find("input").each(function(){this.name=this.name.replace("["+t+"]","["+a+"]")}),e(r).appendTo(".wrap-marker"),n.appendTo("#wrap-clone-"+a),e('<div class="wp-editor-container venomaps_marker_editor"><textarea id="venomaps_infobox_'+a+'" name="venomaps_marker['+a+'][infobox]" class="wp-editor-area" rows="4"></textarea></div>').appendTo("#wrap-clone-"+a),wp.editor.initialize("venomaps_infobox_"+a,o);e('<div class="wpol-remove-marker wpol-btn-link"><span class="dashicons dashicons-no"></span></div>').appendTo("#wrap-clone-"+a)}),e(document).on("click",".wpol-remove-marker",function(){e(this).parent(".wrap-clone").remove()}),e("#wpol-admin-map").length&&e("#infomarker_admin").length&&function(n,o){var t,a=e(".venomaps-get-lat"),r=e(".venomaps-get-lon");if("undefined"==typeof ol||null===ol)return console.log("WARNING: OpenLayers Library not loaded"),!1;var i,l=ol.proj.fromLonLat([-74.005974,40.712776]),s=new ol.View({center:l,zoom:2}),p=new ol.Map({target:"wpol-admin-map",view:s,layers:[new ol.layer.Tile({source:new ol.source.OSM})],interactions:ol.interaction.defaults({mouseWheelZoom:!1})}),m=document.getElementById(o),c=new ol.Overlay({position:l,positioning:"center-center",element:m,stopEvent:!1,dragging:!1});p.addOverlay(c),p.getInteractions().forEach(function(e){e instanceof ol.interaction.DragPan&&(i=e)}),m.addEventListener("mousedown",function(e){i.setActive(!1),c.set("dragging",!0)}),p.on("pointermove",function(e){!0===c.get("dragging")&&c.setPosition(e.coordinate)}),p.on("pointerup",function(n){if(!0===c.get("dragging")){i.setActive(!0),c.set("dragging",!1);var o=n.coordinate,t=ol.proj.toLonLat(o);e(".venomaps-get-lat").val(t[1]),e(".venomaps-get-lon").val(t[0])}}),e(".venomaps-get-coordinates").on("click",function(){var n=e(this),o=e(".venomaps-set-address").val();if(o.length>3){n.hide();var t=encodeURIComponent(o);e.ajax({url:"https://nominatim.openstreetmap.org/search?q="+t+"&format=json",type:"GET"}).done(function(n){!function(n){var o,t;if(e(".venomaps-response").html(""),n[0]){o=n[0].lat,t=n[0].lon;var a=ol.proj.fromLonLat([t,o]);c.setPosition(a),s.setCenter(a),s.setZoom(6)}else o="",t="",e(".venomaps-response").html("Nothing Found");e(".venomaps-get-lat").val(o),e(".venomaps-get-lon").val(t)}(n)}).fail(function(){n.fadeIn()}).always(function(){n.fadeIn()})}}),e(".venomaps-get-lat, .venomaps-get-lon").on("input",function(){clearTimeout(t),t=setTimeout(function(){var e=a.val(),n=r.val(),o=ol.proj.fromLonLat([n,e]);c.setPosition(o),s.setCenter(o),s.setZoom(6)},1e3)})}(0,"infomarker_admin"),e(".wpol-call-repeat").on("click",function(){e(".wpol-repeatable-group");var n=e(".wpol-repeatable-item").last().data("number"),o=parseFloat(n)+1,t='<div class="wpol-repeatable-item wpol-form-group" data-number="'+o+'"><input type="text" class="all-options" name="venomaps_settings[style]['+o+'][name]" value="map style '+o+'"> <input type="url" class="regular-text" name="venomaps_settings[style]['+o+'][url]" value="" placeholder="https://api.maptiler.com/maps/.../style.json?key=..."></div>';e(".wpol-repeatable-group").append(t)}),document.onkeypress=function(e){var n=(e=e||event||null).target?e.target:e.srcElement?e.srcElement:null;if(13==e.keyCode&&("text"==n.type||"url"==n.type||"number"==n.type))return!1}});

jQuery(document).ready(function(e){"use strict";var n;e(document).on("click",".venomaps_marker_upload_btn",function(t){var a=e(this).prev(".venomaps_custom_marker-wrap").find(".venomaps_custom_marker");t.preventDefault(),(n=wp.media.frames.om_metaImageFrame=wp.media()).on("select",function(){var t=n.state().get("selection").first().toJSON();e(a).val(t.url)}),n.open()}),e(document).on("click",".venomaps_marker_remove_btn",function(n){var t=e(this).parent().find(".venomaps_custom_marker");n.preventDefault(),e(t).val("")});var t={tinymce:!0,quicktags:{buttons:"strong,em,link,ul,ol,li,del,close"}};e(".venomaps_marker_editor").each(function(){var n=e(this).find("textarea").attr("id");wp.editor.initialize(n,t)}),e(".wpol-new-marker").on("click",function(){if(e(".wrap-clone").length)var n=e(".wrap-clone").last().find(".clone-marker").clone();else n=e(".clone-marker").last().clone();var a=parseFloat(n.data("index")),o=a+1,r='<div class="wrap-clone" id="wrap-clone-'+o+'"><strong class="wpol-badge"> #'+o+"</strong></div>";n.attr("data-index",o),n.find("input").attr("value",""),n.find("option:selected").removeAttr("selected"),n.find("input:checked").prop("checked",!1),n.find("input").each(function(){this.name=this.name.replace("["+a+"]","["+o+"]")}),e(r).appendTo(".wrap-marker"),n.appendTo("#wrap-clone-"+o),e('<div class="wp-editor-container venomaps_marker_editor"><textarea id="venomaps_infobox_'+o+'" name="venomaps_marker['+o+'][infobox]" class="wp-editor-area" rows="4"></textarea></div>').appendTo("#wrap-clone-"+o),wp.editor.initialize("venomaps_infobox_"+o,t);e('<div class="wpol-remove-marker wpol-btn-link"><span class="dashicons dashicons-no"></span></div>').appendTo("#wrap-clone-"+o)}),e(document).on("click",".wpol-remove-marker",function(){e(this).parent(".wrap-clone").remove()}),e("#wpol-admin-map").length&&e("#infomarker_admin").length&&function(n,t){if("undefined"==typeof ol||null===ol)return console.log("WARNING: OpenLayers Library not loaded"),!1;var a,o=ol.proj.fromLonLat([-74.005974,40.712776]),r=new ol.View({center:o,zoom:2}),i=new ol.Map({target:"wpol-admin-map",view:r,layers:[new ol.layer.Tile({source:new ol.source.OSM})],interactions:ol.interaction.defaults({mouseWheelZoom:!1})}),l=document.getElementById(t),s=new ol.Overlay({position:o,positioning:"center-center",element:l,stopEvent:!1,dragging:!1});i.addOverlay(s),i.getInteractions().forEach(function(e){e instanceof ol.interaction.DragPan&&(a=e)}),l.addEventListener("mousedown",function(e){a.setActive(!1),s.set("dragging",!0)}),i.on("pointermove",function(e){!0===s.get("dragging")&&s.setPosition(e.coordinate)}),i.on("pointerup",function(n){if(!0===s.get("dragging")){a.setActive(!0),s.set("dragging",!1);var t=n.coordinate,o=ol.proj.toLonLat(t);e(".venomaps-get-lat").val(o[1]),e(".venomaps-get-lon").val(o[0])}}),e(".venomaps-get-coordinates").on("click",function(){var n=e(this),t=e(".venomaps-set-address").val();if(t.length>3){n.hide();var a=encodeURIComponent(t);e.ajax({url:"https://nominatim.openstreetmap.org/search?q="+a+"&format=json",type:"GET"}).done(function(n){var t,a,o,i;a=(t=n)[0].lat,o=t[0].lon,i=ol.proj.fromLonLat([o,a]),s.setPosition(i),r.setCenter(i),r.setZoom(6),e(".venomaps-get-lat").val(a),e(".venomaps-get-lon").val(o)}).always(function(){n.fadeIn()})}})}(0,"infomarker_admin"),e(".wpol-call-repeat").on("click",function(){e(".wpol-repeatable-group");var n=e(".wpol-repeatable-item").last().data("number"),t=parseFloat(n)+1,a='<div class="wpol-repeatable-item wpol-form-group" data-number="'+t+'"><input type="text" class="all-options" name="venomaps_settings[style]['+t+'][name]" value="map style '+t+'"> <input type="url" class="regular-text" name="venomaps_settings[style]['+t+'][url]" value="" placeholder="https://api.maptiler.com/maps/.../style.json?key=..."></div>';e(".wpol-repeatable-group").append(a)}),document.onkeypress=function(e){var n=(e=e||event||null).target?e.target:e.srcElement?e.srcElement:null;if(13==e.keyCode&&("text"==n.type||"url"==n.type||"number"==n.type))return!1}});
